#!/usr/bin/env sh

better_ls() {
    # POSIX-safe "local" implementation
    # (ignored in shells that don't support it)
    local_is_supported=false
    ( local x=1 ) 2>/dev/null && local_is_supported=true

    if $local_is_supported; then
        local LS TS files hidden_files current_pwd
    fi

    # Timestamp format
    TS="+%d-%m-%Y %R"

    #
    # CASE 1 — No arguments → enhanced ls in current dir
    #
    if [ "$#" -eq 0 ]; then

        # Count visible + hidden files (except . and ..)
        files=$(\ls -Ua 2>/dev/null | wc -l)

        if [ "$files" -ne 0 ]; then
            # List . and .. and everything else
            # (brace expansion replaced with explicit items)
            \ls -d . .. * \
                -lA --color=auto --human-readable \
                --time-style="$TS" --group-directories-first \
                2>/dev/null

            # Count hidden files (.[^.]*)
            hidden_files=$(\ls -U -d .[^.]* 2>/dev/null | wc -l)

            if [ "$hidden_files" -ne 0 ]; then
                printf '\n'
                \ls -d .[^.]* \
                    -l --color=auto --hide='..' \
                    --human-readable --time-style="$TS" \
                    --group-directories-first
            fi

        else
            # Folder is empty → show only . and ..
            \ls -d . .. \
                -lA --color=auto --human-readable \
                --time-style="$TS" --group-directories-first
        fi

    #
    # CASE 2 — A single directory → recurse into it
    #
    elif [ "$#" -eq 1 ] && [ -d "$1" ]; then
        current_pwd=$PWD
        cd "$1" || exit 1
        better_ls
        cd "$current_pwd" || exit 1

    #
    # CASE 3 — A single file → show detailed info
    #
    elif [ "$#" -eq 1 ] && [ -f "$1" ]; then
        \ls -l --color=auto --human-readable --time-style="$TS" "$1"

    #
    # CASE 4 — Multiple args → standard ls w/ nicer defaults
    #
    else
        \ls --color=auto --human-readable --time-style="$TS" \
            --group-directories-first "$@"
    fi
}

if [ "$(printf '%s\n' "$0")" = "$(printf '%s\n' "$BASH_SOURCE" 2>/dev/null || printf '%s\n' "$0")" ]; then
    better_ls "$@"
fi
