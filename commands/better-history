#!/usr/bin/env sh

better_history() {
    # POSIX-safe color vars
    blue="$(printf '\033[0;34m')"
    nocolor="$(printf '\033[0m')"

    # Detect shell
    case "$SHELL" in
        */bash)
            # Bash history format
            HISTTIMEFORMAT="$blue[%d-%m-%y %T] $nocolor"
            export HISTTIMEFORMAT

            export HISTSIZE=10000
            export HISTFILESIZE=50000
            export HISTCONTROL=ignoreboth

            # Enable append mode (Bash)
            # Using "command" avoids errors if "shopt" doesn’t exist
            command shopt -s histappend 2>/dev/null
            ;;
        
        */zsh)
            # Zsh equivalent behavior
            
            # Timestamp format (Zsh uses %F, %T)
            export HISTTIMEFORMAT=""  # must be empty for zsh
            setopt extended_history     # adds timestamp internally
            
            export HISTSIZE=10000
            export SAVEHIST=50000
            export HISTFILE="$HOME/.zsh_history"

            setopt inc_append_history   # append as commands are executed
            setopt share_history        # share between sessions
            setopt hist_ignore_all_dups
            setopt hist_ignore_space

            ;;
        
        *)
            # Other POSIX shells → no-op, but safe
            :
            ;;
    esac
}

better_history
